---
title: "PSHB Models"
output: html_document
date: "2023-11-21"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Basic life history

Polyphagous shothole borer, *Euwallacea fornicatus*, is a pest of a wide range of plants and has recently expanded its range from south-east Asia to Africa, the Americas, and Australia.

Mated females alight on a host plant and bore a small gallery in the host tree tissue. They seed an ambrosia fungus into this gallery and spend some amount of time building the gallery before laying eggs.  After hatching juveniles, moult through several larval instars, pupate and eventually eclose as adults.  The sex ratio of adults is m:f 1:3-5. Males are wingless and never leave the gallery.  Females are winged. They mate with their brothers, and then exit the gallery to found a new gallery (on the same or a different host).  The rate of egg laying declines steadily over time, with females eventually dying in the gallery rather than forming a new one.

Development of all stages is strongly temperature dependent.  There is some evidence of developmental deaths occurring between hatching and pupation. Other sources of mortality are likely at the dispersal phase (predation, misadventure), otherwise the life history is fairly safe from predation.  

## Our treatment

### Discrete time model

The life history suggests we might more profitably partition the population of females as:

  * $J(t, x)$, the juvenile stages (eggs through pupae): some mortality in the nest, no dispersal
  * $P(t, x)$, the pre-adult stage (the dispersal phase): dispersal, with some mortality
  * $A(t, x)$, the adult stage (breeding females): no dispersal, mortality through senescence.

We measure time, $t$, in degree.days, so can re-scale our results back to the absolute time axis *post hoc*.  We discretise time into small pieces relative to the time scale of the life history.  We could choose something like a time interval being 480 degree hours (24h @ 20 degrees), for example.  We also partition our population among host trees, $x$.

#### Within host dynamics

Within a single host, and using the same state variables above we would have:

\begin{align}
J(t+1) &= J(t) + fA(t) - \alpha_JJ(t) - \delta_JJ(t) \\
P(t+1) &= P(t) + \alpha_JJ(t) - \alpha_PP(t) \\
A(t+1) &= A(t) + \alpha_P(1-\mu)P(t) - \delta_AA(t).
\end{align}

Where:

  * $f$ is the mean fecundity of a female in the population in an interval of time
  * $\alpha_i$ are transition probabilities, describing transition between states
  * $\delta_i$ are transition probabilities, describing transition to the dead state
  * $\mu$ is the probability of dispersing away from the host tree

In matrix form, we first define the vector $\mathbf{N} = \{J, P, A\}$.  Then we have:

$$
\begin{gather}
 \mathbf{N}(t+1) = 
  \begin{bmatrix}
  (1-\alpha_J-\delta_j) & 0 & f \\
  \alpha_J & (1-\alpha_P) & 0 \\
  0 & \alpha_P(1-\mu) & (1-\delta_A)
  \end{bmatrix}
 \mathbf{N}(t)
\end{gather}
$$



Note that there is no density dependence at this stage.  The obvious place to put this would be on $\delta_J$.  That is, we could make $\delta_J$ some positive function of total number of adults produced in the host.

### Between host dynamics
